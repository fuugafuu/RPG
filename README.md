# Undertale-like Networked RPG (Minimal MVP)

日本語READMEです。**Undertale風の弾幕回避バトル**＋**オーバーワールド**＋**シンプルなネット同期**（プレイヤー位置とチャット）を備えた最小構成のRPGです。  
サーバー: Node.js + Express + Socket.IO  
クライアント: HTML5 Canvas + 純JS（外部ゲームエンジン不使用）

> 著作権注意: Undertale の素材（キャラクター/BGM/アセット）は一切含んでいません。UI/ゲーム性のみを参考にした自作実装です。

---

## 機能
- オーバーワールド移動（32pxグリッド）
- NPC スライム（衝突で戦闘突入）
- バトル: コマンド選択（攻撃/はなす/アイテム/にげる）
- 攻撃: タイミングバーでダメージ変化
- 敵ターン: 弾幕（弾避けミニゲーム）。ハートを矢印で操作して回避
- 勝利で元の場所へ戻る/HP回復
- ネット同期（同じマップ上の他プレイヤー位置、チャット）

> 既定ではバトルはローカル（各自のクライアント内）で進行します。同期バトルはチート対策や遅延吸収が必要になるため、段階2として拡張する前提の設計です。

---

## 必要環境
- Node.js 18+ 推奨（16でも可）

## セットアップ
```bash
cd undertale_like_net_rpg
npm install
npm run start
```

ブラウザで `http://localhost:3000` を開きます。

## 操作
- **移動**: 矢印キー / WASD
- **決定**: Z / Enter / Space
- **キャンセル**: X / Escape
- **チャット送信**: 画面右下の入力欄 → Enter

## 仕組みのポイント
- **Socket.IO** により `/socket.io/socket.io.js` が自動配信されるため、クライアントで追加の依存は不要。
- オーバーワールドのプレイヤー位置はサーバーへ毎フレームではなく **一定間隔（50ms）** で送信し、帯域を節約。
- バトルはクライアント側で完結（MVP）。今後、**敵の弾幕シード**や**HP計算**をサーバー側で検証し、**遅延に頑健な当たり判定**へ段階的に昇格可能。

## フォルダ構成
```
undertale_like_net_rpg/
├─ package.json
├─ server.js
├─ README.md
└─ public/
   ├─ index.html
   ├─ style.css
   ├─ client.js
   └─ assets/
      ├─ tilemap.json      # 例のマップ定義
      └─ placeholder.png   # ダミー画像（未使用でもOK）
```

## 次の拡張（設計メモ）
- **同期バトル**: 敵弾幕を「サーバー発の乱数シード＋ステップ」で決定し、クライアントは描画のみ。被弾はクライアント申告+サーバー検証（ヒット窓を広く）。
- **ペース同期**: ターン境界で `ack` を取り、フェーズ遷移を確定させる。
- **アンチチート**: HP/アイテム使用はサーバー側で厳密に。クライアントからのHP回復は無効。
- **フィールド同期**: 取得アイテム/扉解錠をサーバーのワールドステートに記録。
- **アセット**: AsepriteやPiskelでドット絵、BGMは自作・CC0の音源を。

ライセンス: MIT
